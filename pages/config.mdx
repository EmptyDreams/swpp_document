import { Tabs } from 'nextra/components';

# 配置文件的详细说明

&emsp;&emsp;本章将带您了解 swpp 的配置文件的组成，以及对 swpp 内置的所有配置项的解释说明。

## 环境

&emsp;&emsp;无论您是使用 js 还是 ts 编写配置文件，配置文件都将与主体程序共享同一个运行环境，也就是说配置文件中的代码可以访问到主体程序提供的 `globalThis` 等全局数据。

&emsp;&emsp;简单来说就是 swpp 会使用类似于 `require('xxx/xxx/xxx')` 的方式加载配置文件，所以相当于您在当前的项目中又编写了一个代码文件。

&emsp;&emsp;知道了这个，就可以在配置文件中进行一些“骚操作”，即可以动态地修改环境中的一些内容。但是 swpp 并不建议这么做，配置文件在设计上用于修改、调整 swpp 的一些行为，如果您确实需要运行一段有副作用的代码，建议优先通过其它更合理的办法进行。

&emsp;&emsp;swpp 会在加载配置时执行配置文件中的代码，如果您在配置文件顶层抛出了异常，那么将会导致配置加载失败，具体会产生什么后果视前端的具体实现而不同，可能会使整个程序直接结束，也可能只终止 swpp 的任务。

&emsp;&emsp;因为配置文件共享主程序的 `package.json`，所以配置文件中可以使用所有主程序中安装的依赖（包括 swpp 本身）。

## 导出配置的方法

&emsp;&emsp;导出配置：指将您的配置暴露给调用程序（也就是 swpp），swpp 无法读取您未导出的内容。

&emsp;&emsp;swpp 支持两种导出配置的方法，一种是使用 `export default`，一种是使用 `export const xxx`，两种方式最终效果相同，可以根据个人喜好选择一种使用。

&emsp;&emsp;注意：swpp 内部通过判断配置文件是否导出了 `default` 来判断您使用的是哪一种导出方法，所以这两种方法并不能共存，如果您导出了 `default`，swpp 将忽略其它所有导出的内容。

<Tabs items={['default', 'const']}>
    <Tabs.Tab>
        &emsp;&emsp;当您使用 `export default` 导出配置时，您可以借助 `SwppConfigTemplate` 类型，这个类型可以帮助您进行配置设置，IDE
        支持的话还可以提供自动补全。下面是一段示例代码，其中列出了 swpp 内置的所有可调节配置分类：

        ```typescript
        import {defineConfig} from 'swpp-backends'

        export default defineConfig({

            compilationEnv: {},
            crossEnv: {},
            runtimeDep: {},
            crossDep: {},
            runtimeCore: {},
            runtimeEvent: {},
            domConfig: {},
            compilationFileParser: {},
            modifier: {}

        })
        ```
    </Tabs.Tab>
    <Tabs.Tab>
        &emsp;&emsp;当您使用 `export const` 导出配置时，您需要使用具体的子类型来帮助您进行配置设置，IDE 支持的话还可以提供自动补全。下面是一段示例代码，其中列出了 swpp 内置的所有可调节配置分类：

        ```typescript
        import {
            defineCompilationEnv, defineCompilationFP,
            defineCrossDep, defineCrossEnv,
            defineDomConfig, defineModifier,
            defineRuntimeCore, defineRuntimeDep, defineRuntimeEvent
        } from 'swpp-backends'

        export const compilationEnv = defineCompilationEnv({})

        export const crossEnv = defineCrossEnv({})

        export const runtimeDep = defineRuntimeDep({})

        export const crossDep = defineCrossDep({})

        export const runtimeCore = defineRuntimeCore({})

        export const runtimeEvent = defineRuntimeEvent({})

        export const domConfig = defineDomConfig({})

        export const modifier: SwppConfigModifier = {}
        ```
    </Tabs.Tab>

</Tabs>

&emsp;&emsp;注意：上面的示例中一次性列出了所有的分类，实际使用时，建议只写出需要修改的配置，以保持配置文件的简洁性。

## 配置分类与命名规则

&emsp;&emsp;从上面的示例代码中可以看到，swpp 将内置的配置项分为了八类，其命名规则如下：

- `compilation` 开头表示该分类下的配置仅在构建时产生影响，不会被写入到 sw 文件中。
- `runtime` 开头表示该分类下的配置仅会被写入到 sw 文件中，不会在构建时被使用。
- `cross` 开头表示该分类下的配置在构建时有可能被使用，同时会被写入到 sw 文件中。
- `dom` 开头表示该分类下的配置会影响 DOM 端 js 的生成。
- `modifier` 是一项非常特殊且功能强大的配置，后面将会专门进行讲解。
