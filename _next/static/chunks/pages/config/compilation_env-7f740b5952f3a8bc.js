(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[25],{2730:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/config/compilation_env",function(){return n(1137)}])},1137:function(e,s,n){"use strict";n.r(s),n.d(s,{__toc:function(){return o}});var l=n(2676),r=n(3313),i=n(8136),c=n(2534);n(681);var t=n(5594);let o=[{depth:2,value:"DOMAIN_HOST",id:"domain_host"},{depth:2,value:"SERVICE_WORKER",id:"service_worker"},{depth:2,value:"JSON_HTML_LIMIT",id:"json_html_limit"},{depth:2,value:"VERSION_LENGTH_LIMIT",id:"version_length_limit"},{depth:2,value:"SWPP_JSON_FILE",id:"swpp_json_file"},{depth:2,value:"NETWORK_FILE_FETCHER",id:"network_file_fetcher"},{depth:2,value:"ALLOW_NOT_FOUND",id:"allow_not_found"},{depth:2,value:"isStable",id:"isstable"},{depth:2,value:"readLocalFile",id:"readlocalfile"},{depth:2,value:"isNotFound",id:"isnotfound"}];function a(e){let s=Object.assign({h1:"h1",p:"p",code:"code",h2:"h2",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",pre:"pre",span:"span",ul:"ul",li:"li"},(0,t.a)(),e.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.h1,{children:"构建期环境变量"}),"\n",(0,l.jsx)(s.p,{children:"  构建期使用的环境变量。"}),"\n",(0,l.jsx)(s.p,{children:"  该配置项用于放置仅需要在 NodeJs 环境中使用的环境变量。"}),"\n",(0,l.jsxs)(s.p,{children:["  对于每一项配置 ",(0,l.jsx)(s.code,{children:"<KEY>: <value | function(): value>"}),"：",(0,l.jsx)(s.code,{children:"<KEY>"})," 是属性名（推荐函数使用小写驼峰，常量使用大写下划线式命名），",(0,l.jsx)(s.code,{children:"<value>"})," 是环境变量的值。"]}),"\n",(0,l.jsx)(s.p,{children:"  该环境变量中的代码在 NodeJs 环境下执行，执行结果不会被放入 sw.js 中。"}),"\n",(0,l.jsx)(s.h2,{id:"domain_host",children:"DOMAIN_HOST"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"URL"})}),(0,l.jsx)(s.td,{align:"left",children:"网站地址"}),(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"new URL('https://www.example.com')"})})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该项用于告知 swpp 您的网站所在的 URL 地址，swpp 通过该属性判断一个资源是否是外部资源、计算 swpp 文件在线上的地址。"}),"\n",(0,l.jsx)(s.h2,{id:"service_worker",children:"SERVICE_WORKER"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"string"})}),(0,l.jsx)(s.td,{align:"left",children:"sw 文件名"}),(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"sw"})})]})})]}),"\n",(0,l.jsxs)(s.p,{children:["  该项用于告知 swpp 您的 sw 生成的路径及名称，编写时不需要携带拓展名，默认生成到 ",(0,l.jsx)(s.code,{children:"/sw.js"}),"。"]}),"\n",(0,l.jsx)(s.h2,{id:"json_html_limit",children:"JSON_HTML_LIMIT"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"number"})}),(0,l.jsx)(s.td,{align:"left",children:"HTML 数量限制，设置为非正整数表示不限制"}),(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"0"})})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该项用于控制单次刷新 HTML 的最大数量，当刷新的数量超过阈值后，swpp 将一次性清除所有的 HTML 缓存。"}),"\n",(0,l.jsx)(s.p,{children:"  该项在您修改网站的所有或多数 HTML 时非常有用，可以避免在一个版本的更新内容中写入大量的字符串。"}),"\n",(0,l.jsx)(s.h2,{id:"version_length_limit",children:"VERSION_LENGTH_LIMIT"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"number"})}),(0,l.jsx)(s.td,{align:"left",children:"版本信息长度限制"}),(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"1024"})})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该项用于控制版本文件的最大长度，swpp 保证版本文件中的版本信息的长度之和不超过指定的值。设置为 0 可以禁用长度限制，但会导致版本文件无限制的增长，后面随时可能会禁止设置为 0。"}),"\n",(0,l.jsx)(s.p,{children:"  swpp 限制长度的策略是不断移除最远的一个版本号，直到长度满足要求。"}),"\n",(0,l.jsx)(s.h2,{id:"swpp_json_file",children:"SWPP_JSON_FILE"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"object"})}),(0,l.jsx)(s.td,{align:"left",children:"JSON 文件的基本信息"}),(0,l.jsx)(s.td,{align:"center",children:"省略"})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该项用于配置与 swpp 与生成和获取数据文件相关的操作，具体的类型和解释如下："}),"\n",(0,l.jsx)(s.pre,{"data-language":"typescript","data-theme":"default",children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// noinspection TypeScriptUnresolvedReference"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"interface"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Type"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 生成的数据文件的目录，默认值：`swpp` */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    swppPath"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 后台 tracker 信息的文件名，默认值：`tracker.json` */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    trackerPath"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 版本文件的文件名，默认值：`update.json` */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    versionPath"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * 拉取 tracker 文件，默认操作是从网络中拉取文件并解析。"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     *"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * 拉取的地址为：`https://{DOMAIN_HOST}/{swppPath}/{trackerPath}`"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     */"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchTrackerFile"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" ("})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"      compilation"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"CompilationData"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    ) "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Promise"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"FileUpdateTracker"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * 拉取版本文件，默认操作是从网络中拉取文件并解析。"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     *"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * 拉取的地址为：`https://{DOMAIN_HOST}/{swppPath}/{versionPath}`"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     */"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetchVersionFile"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" () "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Promise"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"UpdateJson"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsxs)(s.p,{children:["  修改该项配置时，可以仅修改部分字段，比如传入：",(0,l.jsx)(s.code,{children:"{ swppPath: 'example/hello' }"})," 可以仅修改 ",(0,l.jsx)(s.code,{children:"swppPath"})," 的值，而其它的值保持默认。"]}),"\n",(0,l.jsx)(s.h2,{id:"network_file_fetcher",children:"NETWORK_FILE_FETCHER"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"NetworkFileHandler"})}),(0,l.jsx)(s.td,{align:"left",children:"拉取网络文件"}),(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"FiniteConcurrencyFetcher"})})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该配置项用于修改 swpp 从网络中拉取文件的行为，其类型定义如下："}),"\n",(0,l.jsx)(s.pre,{"data-language":"typescript","data-theme":"default",children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"interface"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"NetworkFileHandler"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 最大并发量，当并发量超过此限制时，后到达的请求应当等待队列中的请求完成。默认为：100 */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    limit"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"number"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 拉取文件时使用的 referer，默认为：https://swpp.example.com */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    referer"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 拉取文件时使用的 ua，默认为：swpp-backends */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    userAgent"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 需要额外写入的 header */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    headers"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" { [name"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"]"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" }"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 拉取文件 */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetch"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(request"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"RequestInfo"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"URL"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Promise"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Response"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:">"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/** 获取指定文件的类型 */"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"getUrlContentType"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(url"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" response"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?:"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Response"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,l.jsxs)(s.p,{children:["  默认的实现已经可以满足绝大多数要求，大多数情况下不需要修改 ",(0,l.jsx)(s.code,{children:"fetch"})," 和 ",(0,l.jsx)(s.code,{children:"getUrlContentType"}),"。"]}),"\n",(0,l.jsxs)(s.p,{children:["  默认实现使用 NodeJS 内置的 ",(0,l.jsx)(s.code,{children:"fetch"})," 函数拉取文件，对于使用低版本 NodeJS 的用户，则需要自行覆盖 ",(0,l.jsx)(s.code,{children:"fetch"})," 的实现。"]}),"\n",(0,l.jsx)(s.h2,{id:"allow_not_found",children:"ALLOW_NOT_FOUND"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"AllowNotFoundEnum"})}),(0,l.jsx)(s.td,{align:"left",children:"404 等级"}),(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"ALLOW_STATUS"})})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该配置项用于设置拉取数据文件时能够接受的 404 级别。共分为三个级别："}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"ALLOW_ALL"}),": 允许任何形式的 404（response 返回 404 状态码、DNS 解析错误等）"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"ALLOW_STATUS"}),": 允许 response 返回 404 状态码"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"REJECT_ALL"}),": 不允许任何形式的 404 错误"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"  当遇到不允许的 404 错误时 swpp 将直接结束构建，设置合理的报错等级可以防止网站被错误地部署到线上，从而导致历史版本丢失。"}),"\n",(0,l.jsx)(s.h2,{id:"isstable",children:"isStable"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"(url: URL) => boolean"})}),(0,l.jsx)(s.td,{align:"left",children:"检查一个链接是否是稳定的"}),(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"() => false"})})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该配置项用于检查一个链接是否是稳定的，也就是 URL 不变其返回的结果永远不变。"}),"\n",(0,l.jsx)(s.p,{children:"  合理地设置该项可以加快 swpp 构建的速度，减少网络请求的数量。"}),"\n",(0,l.jsx)(s.h2,{id:"readlocalfile",children:"readLocalFile"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"(path: string) => Promise<crypto.BinaryLike>"})}),(0,l.jsx)(s.td,{align:"left",children:"从本地读取一个文件"}),(0,l.jsx)(s.td,{align:"center",children:"省略"})]})})]}),"\n",(0,l.jsxs)(s.p,{children:["  该配置项用于从本地读取一个文件，其接受一个参数 ",(0,l.jsx)(s.code,{children:"path"}),"，可能为绝对路径也可能为相对路径，默认实现使用 ",(0,l.jsx)(s.code,{children:"fs"})," 以 UTF-8 编码读取文件。"]}),"\n",(0,l.jsxs)(s.p,{children:["  对于 HTML、CSS、JS 类型的文件，必须返回 ",(0,l.jsx)(s.code,{children:"string"}),"，其它类型的文件只需要满足 ",(0,l.jsx)(s.code,{children:"crypto.BinaryLike"})," 即可。"]}),"\n",(0,l.jsx)(s.h2,{id:"isnotfound",children:"isNotFound"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"object"})}),(0,l.jsx)(s.td,{align:"left",children:"判断一个请求是否是 404 错误"}),(0,l.jsx)(s.td,{align:"center",children:"省略"})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该配置项用于判断一个请求的结果是否是 404 错误，默认实现如下："}),"\n",(0,l.jsx)(s.pre,{"data-language":"typescript","data-theme":"default",children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"default"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * 通过 response 判断是否是 404，在这里返回 true 均会被认定为状态码 404"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     *"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * 注意不能直接读取传入的 response 的 body，如果需要修改先 clone 一下"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     *"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" 返回 `true` 表示判定为 404"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     */"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"response"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (response"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Response"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"response"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".status "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"404"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * 当拉取文件报错时通过该函数判断是否是 404"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     * "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@return"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" 返回 `true` 表示判定为 404"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"     */"})}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"error"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (err"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"any"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"err"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"?."}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"cause"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"?.code "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"==="}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'ENOTFOUND'"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"};"})})]})})]})}let h={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,t.a)(),e.components);return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(a,{...e})}):a(e)},pageOpts:{filePath:"pages/config/compilation_env.mdx",route:"/config/compilation_env",timestamp:1724072103e3,pageMap:[{kind:"Meta",data:{index:"介绍",quickstart:"快速开始",config:"配置文件"}},{kind:"Folder",name:"config",route:"/config",children:[{kind:"Meta",data:{runtime_dep:"RuntimeDep",cross_env:"CrossEnv",compilation_env:"CompilationEnv",runtime_core:"RuntimeCore",cross_dep:"CrossDep",runtime_event:"RuntimeEvent",dom_config:"DomConfig",modifier:"Modifier"}},{kind:"MdxPage",name:"compilation_env",route:"/config/compilation_env"},{kind:"MdxPage",name:"cross_dep",route:"/config/cross_dep"},{kind:"MdxPage",name:"cross_env",route:"/config/cross_env"},{kind:"MdxPage",name:"dom_config",route:"/config/dom_config"},{kind:"MdxPage",name:"modifier",route:"/config/modifier"},{kind:"MdxPage",name:"runtime_core",route:"/config/runtime_core"},{kind:"MdxPage",name:"runtime_dep",route:"/config/runtime_dep"},{kind:"MdxPage",name:"runtime_event",route:"/config/runtime_event"}]},{kind:"MdxPage",name:"config",route:"/config"},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"quickstart",route:"/quickstart"}],flexsearch:{codeblocks:!0},title:"构建期环境变量",headings:o},pageNextRoute:"/config/compilation_env",nextraLayout:i.ZP,themeConfig:c.Z};s.default=(0,r.j)(h)},2534:function(e,s,n){"use strict";var l=n(2676);n(5271);var r=n(5458);let i="Swpp 官方文档";s.Z={logo:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"icon",viewBox:"0 0 1024 1024",fill:"currentcolor",children:[(0,l.jsx)("path",{d:"M469.333 810.667V341.333a128 128 0 0 0-128-128H128v597.334zM512 213.333A212.992 212.992 0 0 1 682.667 128h298.666v768H42.667V128h298.666c69.803 0 131.755 33.493 170.667 85.333m42.667 128v469.334H896V213.333H682.667a128 128 0 0 0-128 128"}),(0,l.jsx)("text",{xmlSpace:"preserve",x:"215",y:"485",fillOpacity:"null",stroke:"null",strokeOpacity:"null",strokeWidth:"0",fontFamily:"'Courier New', Courier, monospace",fontSize:"250",fontWeight:"bold",transform:"matrix(2.177 0 0 2.07854 -332.879 -331.617)",children:"S"}),(0,l.jsx)("text",{xmlSpace:"preserve",x:"653",y:"499",fillOpacity:"null",stroke:"null",strokeOpacity:"null",strokeWidth:"0",fontFamily:"'Courier New', Courier, monospace",fontSize:"250",fontWeight:"bold",transform:"matrix(1.78385 0 0 2.06235 -570.614 -357.776)",children:"W"})]}),(0,l.jsx)("span",{style:{marginLeft:".4em",fontWeight:"bold"},children:i})]}),sidebar:{defaultMenuCollapseLevel:1},project:{link:"https://github.com/EmptyDreams/swpp-backends"},docsRepositoryBase:"https://github.com/EmptyDreams/swpp_document/tree/main/",useNextSeoProps:()=>({titleTemplate:"%s – ".concat(i)}),footer:{text:"\xa9 2024-present ".concat(i)},head:(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,l.jsx)("meta",{property:"og:description",content:"Service Worker Plus Plus 的官方文档"}),(0,l.jsx)("meta",{name:"keywords",content:"ServiceWorker, swpp"})]}),...r.Z}},5184:function(){}},function(e){e.O(0,[580,888,774,179],function(){return e(e.s=2730)}),_N_E=e.O()}]);