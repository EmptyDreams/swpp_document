(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{45:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/config/cross_dep",function(){return n(1292)}])},1292:function(e,s,n){"use strict";n.r(s),n.d(s,{__toc:function(){return c}});var l=n(2676),r=n(6957),i=n(3772);let c=[{depth:2,value:"matchCacheRule",id:"matchcacherule"},{depth:2,value:"normalizeUrl",id:"normalizeurl"},{depth:2,value:"matchUpdateRule",id:"matchupdaterule"}];function o(e){let s=Object.assign({h1:"h1",p:"p",code:"code",pre:"pre",span:"span",h2:"h2",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",ul:"ul",li:"li",a:"a"},(0,i.a)(),e.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.h1,{children:"双期函数依赖"}),"\n",(0,l.jsx)(s.p,{children:"  运行时和编译期的函数依赖，其中的内容会被写入到 sw 中。"}),"\n",(0,l.jsx)(s.p,{children:"  该配置项用于放置所有同时在浏览器和 NodeJs 环境下执行的工具函数。"}),"\n",(0,l.jsxs)(s.p,{children:["  对于每一项配置 ",(0,l.jsx)(s.code,{children:"<KEY>: { <runOnBrowser>, <runOnNode> }"}),"：",(0,l.jsx)(s.code,{children:"<KEY>"})," 是函数名，",(0,l.jsx)(s.code,{children:"<runOnBrowser>"})," 是在浏览器环境下执行的代码，",(0,l.jsx)(s.code,{children:"<runOnNode>"})," 是在 NodeJs 环境下执行的代码。"]}),"\n",(0,l.jsxs)(s.p,{children:["  对于在浏览器环境下执行的代码，可以像 ",(0,l.jsx)(s.code,{children:"RuntimeDep"})," 一样引用其它运行时的环境变量、依赖函数等内容。"]}),"\n",(0,l.jsxs)(s.p,{children:["  对于在 NodeJs 环境下执行的代码，可以使用 ",(0,l.jsx)(s.code,{children:"this"})," 调用 ",(0,l.jsx)(s.code,{children:"<runOnBrowser>"}),"（前提是 ",(0,l.jsx)(s.code,{children:"<runOnBrowser>"})," 中没有依赖浏览器环境的代码）。"]}),"\n",(0,l.jsxs)(s.p,{children:["  ",(0,l.jsx)(s.code,{children:"<runOnBrowser>"})," 和 ",(0,l.jsx)(s.code,{children:"<runOnNode>"})," 中的代码的行为应当完全一致。注意：此处说的行为一致是两者应当产生相同的副作用，内部具体实现可以不一样。"]}),"\n",(0,l.jsx)(s.p,{children:"  例："}),"\n",(0,l.jsx)(s.pre,{"data-language":"typescript","data-theme":"default",children:(0,l.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {defineCrossDep} "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'swpp-backends'"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:" "}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"defineCrossDep"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"({"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    example"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {  "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 不推荐！双端的行为不完全一致！但如果是为了进行代码测试，可以临时这么干。"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"runOnBrowser"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" () "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'hello'"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"runOnNode"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" () "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'world'"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    invokeExample"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"runOnBrowser"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" () "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".log"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'hello world'"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"runOnNode"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,l.jsxs)(s.span,{className:"line",children:[(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            "}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".runOnBrowser"}),(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        }"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,l.jsx)(s.span,{className:"line",children:(0,l.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,l.jsx)(s.h2,{id:"matchcacherule",children:"matchCacheRule"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"(url: URL) => number | false | null | undefined"})}),(0,l.jsx)(s.td,{align:"left",children:"判断一个资源是否需要缓存"}),(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"() => false"})})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该项用于判断一个资源是否需要被前端缓存，其中各个返回值的含义如下："}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"false"})," ",(0,l.jsx)(s.code,{children:"null"})," ",(0,l.jsx)(s.code,{children:"undefined"})," 或 ",(0,l.jsx)(s.code,{children:"0"}),"：表示不需要缓存"]}),"\n",(0,l.jsx)(s.li,{children:"正数：表示需要缓存，缓存类型为定时缓存，单位为毫秒，超过指定时间后缓存自动失效"}),"\n",(0,l.jsx)(s.li,{children:"负数：表示需要缓存，缓存类型为永久缓存，仅能通过增量更新失效"}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"normalizeurl",children:"normalizeUrl"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"(url: string) => string"})}),(0,l.jsx)(s.td,{align:"left",children:"归一化 URL"}),(0,l.jsx)(s.td,{align:"center",children:"省略"})]})})]}),"\n",(0,l.jsx)(s.p,{children:"  该项用于将链接进行归一化，归一化的作用是防止目标相同但连接形式不同的资源被重复缓存。默认的实现会对 HTML 资源的 URL 进行处理："}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:["如果链接以 ",(0,l.jsx)(s.code,{children:"/index.html"})," 结尾会被替换为 ",(0,l.jsx)(s.code,{children:"/"})]}),"\n",(0,l.jsxs)(s.li,{children:["如果链接以 ",(0,l.jsx)(s.code,{children:"/xxx.html"})," 结尾会被替换为 ",(0,l.jsx)(s.code,{children:"/xxx"})]}),"\n",(0,l.jsx)(s.li,{children:"否则保持原链接"}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"matchupdaterule",children:"matchUpdateRule"}),"\n",(0,l.jsxs)(s.table,{children:[(0,l.jsx)(s.thead,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.th,{align:"center",children:"类型"}),(0,l.jsx)(s.th,{align:"left",children:"说明"}),(0,l.jsx)(s.th,{align:"center",children:"默认值"})]})}),(0,l.jsx)(s.tbody,{children:(0,l.jsxs)(s.tr,{children:[(0,l.jsx)(s.td,{align:"center",children:(0,l.jsx)(s.code,{children:"(exp: UpdateChangeExp) => ((url: string) => boolean | undefined | null)"})}),(0,l.jsx)(s.td,{align:"left",children:"匹配缓存更新规则"}),(0,l.jsx)(s.td,{align:"center",children:"省略"})]})})]}),"\n",(0,l.jsxs)(s.p,{children:["  该项用于判断一个 ",(0,l.jsx)(s.code,{children:"UpdateChangeExp"})," 应当如何被程序理解，返回一个函数，该函数用于判断指定资源是否应该被刷新。"]}),"\n",(0,l.jsxs)(s.p,{children:["  内置的规则已经可以满足大多数情况的要求，一般只有需要自定义新的规则时才需要修改该项，具体的实现可以参考 ",(0,l.jsx)(s.a,{href:"https://github.com/EmptyDreams/swpp-backends/blob/v3/src/swpp/database/CrossDepCode.ts#L64",children:"源代码"}),"。"]})]})}s.default=(0,r.j)({MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,i.a)(),e.components);return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(o,{...e})}):o(e)},pageOpts:{filePath:"pages/config/cross_dep.mdx",route:"/config/cross_dep",timestamp:1725269991e3,title:"双期函数依赖",headings:c},pageNextRoute:"/config/cross_dep"})}},function(e){e.O(0,[957,888,774,179],function(){return e(e.s=45)}),_N_E=e.O()}]);