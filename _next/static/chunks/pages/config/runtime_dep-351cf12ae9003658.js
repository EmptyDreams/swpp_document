(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{6553:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/config/runtime_dep",function(){return n(3359)}])},3359:function(e,s,n){"use strict";n.r(s),n.d(s,{__toc:function(){return h},default:function(){return j}});var r=n(2676),l=n(3313),i=n(8136),o=n(2534);n(681);var c=n(5594),t={src:"/_next/static/media/fast-url.82b2aa99.png",height:385,width:638,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAQAAADSmGXeAAAAQklEQVR42iXJ0QqAMAxD0f7/f6ovitOJqDS7hq1QQk4iJRovMwuJFPS7XCceICo3h6Gw+YvBXvnYGVM0QRpWTmfqB/teTjDKOKyRAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:5},a={src:"/_next/static/media/standby-url.f7e3200a.png",height:489,width:736,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAFCAQAAADSmGXeAAAAO0lEQVR42g3DSQ6AIBAAsPn/Nz15MASXIBimkqYxM000myIzEnxOuwMBHOpS1rg8bs1AV8SbQ1c11pI/CFxOaZw3PaIAAAAASUVORK5CYII=",blurWidth:8,blurHeight:5};let h=[{depth:2,value:"matchFromCaches",id:"matchfromcaches"},{depth:2,value:"writeResponseToCache",id:"writeresponsetocache"},{depth:2,value:"markCacheInvalid",id:"markcacheinvalid"},{depth:2,value:"isValidCache",id:"isvalidcache"},{depth:2,value:"readVersion",id:"readversion"},{depth:2,value:"writeVersion",id:"writeversion"},{depth:2,value:"postMessage",id:"postmessage"},{depth:2,value:"isFetchSuccessful",id:"isfetchsuccessful"},{depth:2,value:"fetchWrapper",id:"fetchwrapper"},{depth:2,value:"isCors",id:"iscors"},{depth:2,value:"getFastestRequests",id:"getfastestrequests"},{depth:2,value:"getStandbyRequests",id:"getstandbyrequests"},{depth:2,value:"fetchFastest",id:"fetchfastest"},{depth:2,value:"fetchStandby",id:"fetchstandby"},{depth:2,value:"fetchFile",id:"fetchfile"},{depth:2,value:"isBlockRequest",id:"isblockrequest"},{depth:2,value:"modifyRequest",id:"modifyrequest"}];function d(e){let s=Object.assign({h1:"h1",p:"p",code:"code",pre:"pre",span:"span",h2:"h2",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td",a:"a",ul:"ul",li:"li",img:"img"},(0,c.a)(),e.components);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h1,{children:"运行时函数依赖"}),"\n",(0,r.jsx)(s.p,{children:"  该配置项用于放置所有仅在浏览器 SW 环境下执行的工具函数。"}),"\n",(0,r.jsxs)(s.p,{children:["  对于每一项配置 ",(0,r.jsx)(s.code,{children:"<KEY>: <function>"}),"：",(0,r.jsx)(s.code,{children:"<KEY>"})," 是函数名（推荐使用小写驼峰式命名），",(0,r.jsx)(s.code,{children:"<function>"})," 是函数体。"]}),"\n",(0,r.jsx)(s.p,{children:"  如果函数体中需要使用其它运行时的环境变量、函数依赖等内容，直接调用即可，如果需要避免 IDE 报错/ 警告，可以在配置文件中声明一些不导出的变量，以此假装上下文中存在该函数。 TS 还可以使用 @ts-ignore 忽略相关的错误。"}),"\n",(0,r.jsx)(s.p,{children:"  例："}),"\n",(0,r.jsx)(s.pre,{"data-language":"typescript","data-theme":"default",children:(0,r.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {defineRuntimeDep} "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'swpp-backends'"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 该代码将在 sw. js 中创建一系列函数："})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// const example = () => console. log('hello')"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// function invokeExample() {"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"//     example()"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// }"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"runtimeDep"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"defineRuntimeDep"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"({"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"example"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" () "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"console"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:". log"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'hello'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"invokeExample"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"example"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 如果为了避免 IDE 报错，还可以在文件任意一个位置编写类似的代码："})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// let example: () => void       good"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// let example = any             不推荐，因为丢失了类型，会影响 IDE 的自动补全和静态类型推断"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 或者直接在函数调用的位置使用 @ts-ignore 也可以避免报错，同样不推荐，理由同上"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"example"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" () "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"void"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 这行代码用来消除 IDE 警告"})]})]})}),"\n",(0,r.jsx)(s.h2,{id:"matchfromcaches",children:"matchFromCaches"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: RequestInfo | URL) => Promise<Response |undefined>"})}),(0,r.jsx)(s.td,{align:"left",children:"尝试匹配一个缓存"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项用于从缓存库中读取一个缓存，默认使用 ",(0,r.jsx)(s.a,{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Cache",children:"Cache API"}),"。"]}),"\n",(0,r.jsx)(s.h2,{id:"writeresponsetocache",children:"writeResponseToCache"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: RequestInfo | URL, response: Response, date?: boolean) => Promise<void>"})}),(0,r.jsx)(s.td,{align:"left",children:"写入缓存"})]})})]}),"\n",(0,r.jsx)(s.p,{children:"  该项用于向缓存写入或更新一条数据，默认实现如下："}),"\n",(0,r.jsx)(s.pre,{"data-language":"typescript","data-theme":"default",children:(0,r.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  * "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@param"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" request 请求信息"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  * "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@param"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" response 响应体"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  * "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@param"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" date 是否存储时间戳"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  */"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"async"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (request"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"RequestInfo"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"URL"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" response"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Response"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" date"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?:"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"boolean"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (date) {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 如果需要存储时间戳就新建一个 Response 并写入新的 header"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"headers"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Headers"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"response"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".headers);"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"headers"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".set"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"STORAGE_TIMESTAMP"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Date"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"()"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".toISOString"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"());"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        response "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"new"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Response"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"response"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".body"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            status"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"response"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".status"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"            headers"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        });"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"cache"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"caches"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".open"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"CACHE_NAME"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:");"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"await"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"cache"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".put"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(request"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" response);"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"};"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"// 用于消除 IDE 报错，值在其它配置项中插入到 SW"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"CACHE_NAME"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"STORAGE_TIMESTAMP"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]})]})}),"\n",(0,r.jsx)(s.h2,{id:"markcacheinvalid",children:"markCacheInvalid"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: RequestInfo | URL) => Promise<void>"})}),(0,r.jsx)(s.td,{align:"left",children:"标记一个缓存为失效缓存"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  swpp 默认使缓存失效的方法是在响应体当中写入一个 ",(0,r.jsx)(s.a,{href:"/config/cross_env#invalid_key",children:"特定的 header"}),"，当尝试使用这个缓存时，检查缓存是否过期，如果过期则尝试从网络拉取最新内容。"]}),"\n",(0,r.jsxs)(s.p,{children:["  如果需要的话您可以通过自定义 ",(0,r.jsx)(s.code,{children:"markCacheInvalid"})," 和 ",(0,r.jsx)(s.code,{children:"isValidCache"}),"，将缓存失效方法改为立即删除。"]}),"\n",(0,r.jsx)(s.h2,{id:"isvalidcache",children:"isValidCache"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(response: Response, rule: number) => boolean"})}),(0,r.jsx)(s.td,{align:"left",children:"判断缓存是否有效"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项用于判断一个缓存是否还有效，返回 ",(0,r.jsx)(s.code,{children:"true"})," 将直接使用这个缓存，否则将尝试拉取新的值。"]}),"\n",(0,r.jsx)(s.p,{children:"  其中第二个参数是缓存的过期时间，若为负表明该缓存没有过期时间，为正时单位为毫秒，不可能为零。"}),"\n",(0,r.jsx)(s.p,{children:"  如果您想要将缓存失效方法改为立即删除可以使用如下配置："}),"\n",(0,r.jsx)(s.pre,{"data-language":"typescript","data-theme":"default",children:(0,r.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"import"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {defineRuntimeDep} "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"from"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'swpp-backends'"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"runtimeDep"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"defineRuntimeDep"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"({"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"markCacheInvalid"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (request"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"RequestInfo"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"|"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"URL"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:") "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"caches"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".open"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"CACHE_NAME"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".then"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(cache "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"cache"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:".delete"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(request))"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"isValidCache"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" () "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"true"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"})"})}),"\n",(0,r.jsx)(s.span,{className:"line",children:" "}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"let"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"CACHE_NAME"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"string"})]})]})}),"\n",(0,r.jsx)(s.h2,{id:"readversion",children:"readVersion"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"() => Promise<BrowserVersion | undefined>"})}),(0,r.jsx)(s.td,{align:"left",children:"读取客户端版本号"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项用于读取客户端当前的版本号，默认实现使用 ",(0,r.jsx)(s.a,{href:"#matchfromcaches",children:"matchFromCaches"})," 读取。"]}),"\n",(0,r.jsx)(s.h2,{id:"writeversion",children:"writeVersion"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(version: BrowserVersion) => Promise<void>"})}),(0,r.jsx)(s.td,{align:"left",children:"更新客户端版本号"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项用于设置客户端当前的版本号，默认实现使用 ",(0,r.jsx)(s.a,{href:"#writeresponsetocache",children:"writeResponseToCache"})," 实现。"]}),"\n",(0,r.jsxs)(s.p,{children:["  注意：如果您需要自定义该项目，务必在写入缓存前，为传入的 ",(0,r.jsx)(s.code,{children:"version"})," 中的 ",(0,r.jsx)(s.code,{children:"tp"})," 字段赋值：",(0,r.jsx)(s.code,{children:"version.tp = Date.now()"}),"。"]}),"\n",(0,r.jsx)(s.h2,{id:"postmessage",children:"postMessage"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(type: string, data: any, ...goals: Client[]) => Promise<void>"})}),(0,r.jsx)(s.td,{align:"left",children:"向指定客户端发送消息"})]})})]}),"\n",(0,r.jsx)(s.p,{children:"  该配置项用于向指定的客户端发送消息，其中各个变量解释如下："}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"type"}),": 消息类型"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"data"}),": 消息内容"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"goals"}),": 客户端对象，若该项传入了一个空的数组，表明向所有客户端发送消息"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"isfetchsuccessful",children:"isFetchSuccessful"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(response: Response) => boolean"})}),(0,r.jsx)(s.td,{align:"left",children:"检查一个请求是否成功"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项用于通过 ",(0,r.jsx)(s.code,{children:"Response"})," 检查拉取是否成功，默认通过状态码判断（若状态码返回 ",(0,r.jsx)(s.code,{children:"200"})," ",(0,r.jsx)(s.code,{children:"301"})," ",(0,r.jsx)(s.code,{children:"302"})," ",(0,r.jsx)(s.code,{children:"307"})," ",(0,r.jsx)(s.code,{children:"308"})," 会被视为成功）。"]}),"\n",(0,r.jsxs)(s.p,{children:["  请注意！！！缓存、URL 竞速、备用 URL 等功能均会使用该函数判断某个请求是否成功，返回错误地返回 ",(0,r.jsx)(s.code,{children:"true"})," 或 ",(0,r.jsx)(s.code,{children:"false"})," 会导致功能异常："]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["对于缓存：若错误地返回了 ",(0,r.jsx)(s.code,{children:"true"})," 会导致将失败的响应缓存到本地，若错误地返回了 ",(0,r.jsx)(s.code,{children:"false"})," 将会导致结果不被缓存。"]}),"\n",(0,r.jsxs)(s.li,{children:["对于 URL 竞速和备用 URL：若错误地返回了 ",(0,r.jsx)(s.code,{children:"true"})," 会导致将一个失败的响应视为成功响应作为最终的响应结果；若错误地返回了 ",(0,r.jsx)(s.code,{children:"false"})," 会错失正确的响应，可能导致最终响应失败。"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"  部分 CDN 响应错误时不使用状态码进行标记，而是使用响应体中的内容，此时有下面几种解决方案："}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:"避开该 CDN，使用其它 CDN 进行替代"}),"\n",(0,r.jsx)(s.li,{children:"对于该 CDN 的资源不启用缓存等功能"}),"\n",(0,r.jsxs)(s.li,{children:["自定义 ",(0,r.jsx)(s.code,{children:"isFetchSuccessful"}),"，在函数中读取响应体的数据判断请求是否成功。",(0,r.jsx)("br",{}),"\n需要特别注意的是，如果需要在该函数中读取 body，请先克隆响应体，然后读取克隆后的结果，否则会导致后续的流程无法读取响应体内容。"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"fetchwrapper",children:"fetchWrapper"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: Request, banCache: boolean, cors: boolean, optional?: RequestInit) => Promise<Response>"})}),(0,r.jsx)(s.td,{align:"left",children:"从网络拉取文件"})]})})]}),"\n",(0,r.jsx)(s.p,{children:"  一般不需要覆盖，默认实现如下："}),"\n",(0,r.jsx)(s.pre,{"data-language":"typescript","data-theme":"default",children:(0,r.jsxs)(s.code,{"data-language":"typescript","data-theme":"default",children:[(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"/**"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  * "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@param"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" request 请求信息"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  * "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@param"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" banCache 是否禁用 HTTP 缓存"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  * "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@param"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" cors 是否启用 cors，填 false 使用 no-cors 模式"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  * "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"@param"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:" optional 请求配置"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-comment)"},children:"  */"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(request"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Request"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" banCache"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"boolean"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" cors"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"boolean"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" optional"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?:"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"RequestInit"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:")"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Promise"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"<"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"Response"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"> "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"=>"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"init"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"RequestInit"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        referrerPolicy"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"request"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".referrerPolicy "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"??"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"''"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"..."}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"optional"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"init"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".cache "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" banCache "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"?"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'no-store'"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'default'"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"if"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" (cors) {"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"init"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".mode "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'cors'"})]}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-constant)"},children:"init"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:".credentials "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'same-origin'"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,r.jsxs)(s.span,{className:"line",children:[(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-function)"},children:"fetch"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"(request"}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-token-punctuation)"},children:","}),(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:" init)"})]}),"\n",(0,r.jsx)(s.span,{className:"line",children:(0,r.jsx)(s.span,{style:{color:"var(--shiki-color-text)"},children:"}"})})]})}),"\n",(0,r.jsx)(s.h2,{id:"iscors",children:"isCors"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: Request) => boolean"})}),(0,r.jsx)(s.td,{align:"left",children:"判断一个资源是否使用 cors"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项用于判断一个资源是使用 cors 还是 no-cors 模式，返回 ",(0,r.jsx)(s.code,{children:"true"})," 表示使用 cors 模式，否则表示使用 no-cors。默认永远返回 ",(0,r.jsx)(s.code,{children:"false"}),"。"]}),"\n",(0,r.jsx)(s.p,{children:"  由于 no-cors 模式下 swpp 无法读取响应体中的状态码，所以对于需要应用缓存、URL 竞速、备用 URL 的请求，全部强制使用 cors 模式。"}),"\n",(0,r.jsx)(s.h2,{id:"getfastestrequests",children:"getFastestRequests"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: Request) => Request[] | undefined"})}),(0,r.jsx)(s.td,{align:"left",children:"获取竞速列表"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项用于启用 URL 竞速，返回任意转换为 ",(0,r.jsx)(s.code,{children:"false"})," 的值均表示对于给定的资源不启用 URL 竞速。"]}),"\n",(0,r.jsx)(s.p,{children:"  注意事项："}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["swpp 会严格按照返回的数组中的内容进行并发请求，如果您返回的数组中不包含原有的 ",(0,r.jsx)(s.code,{children:"Request"}),"，swpp 将认为您希望跳过原有的资源地址。"]}),"\n",(0,r.jsx)(s.li,{children:"开启该功能后，会较为显著地增加网络压力、流量消耗和 CPU 压力。"}),"\n",(0,r.jsx)(s.li,{children:"请勿滥用该功能（包括但不限于使用该功能实现类似于将网站部署到 NPM CDN 上的功能），这有违道德、容易被 CDN 封杀。"}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"  同时需要注意的是，"}),"\n",(0,r.jsx)(s.h2,{id:"getstandbyrequests",children:"getStandbyRequests"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: Request) => {t: number, l: () => Request[]} | undefined"})}),(0,r.jsx)(s.td,{align:"left",children:"获取备用列表"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项用于启用备用 URL，返回任意转换为 ",(0,r.jsx)(s.code,{children:"false"})," 值均表示对于给定的资源不启用备用 URL。"]}),"\n",(0,r.jsx)(s.p,{children:"  对于返回值："}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"t"}),": 超时时间（毫秒），如果拉取原始 ",(0,r.jsx)(s.code,{children:"Request"})," 的时间超过了这个时间，将会开始并发拉取备用 URL。"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"l"}),": 备用 Request 列表的 getter，设计成这样是避免在无需备用 URL 时生成列表占用 CPU、内存资源。"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"  注意事项："}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["返回的列表中不应当包含原始 ",(0,r.jsx)(s.code,{children:"Request"}),"，swpp 会先尝试访问原始 ",(0,r.jsx)(s.code,{children:"Request"}),"。"]}),"\n",(0,r.jsxs)(s.li,{children:["应当把最可能成功、速度最快的链接设置为原始 ",(0,r.jsx)(s.code,{children:"Request"}),"，否则网站加载可能会出现比较大的延迟。"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"fetchfastest",children:"fetchFastest"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(list: Request[], optional?: RequestInit) => Promise<Response>"})}),(0,r.jsx)(s.td,{align:"left",children:"通过竞速拉取文件"})]})})]}),"\n",(0,r.jsx)(s.p,{children:"  该项用于执行 URL 竞速的功能，默认实现已经能满足大部分需求，一般情况下无需覆盖。"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"URL 竞速流程",placeholder:"blur",src:t})}),"\n",(0,r.jsx)(s.h2,{id:"fetchstandby",children:"fetchStandby"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: Request, standbyRequests: {t: number, l: () => Request[]}, optional?: RequestInit) => Promise<Response>"})}),(0,r.jsx)(s.td,{align:"left",children:"通过备用 URL 拉取文件"})]})})]}),"\n",(0,r.jsx)(s.p,{children:"  该项用于执行备用 URL 功能，默认实现已经能满足大部分需求，一般情况下无需覆盖。"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"备用 URL 流程",placeholder:"blur",src:a})}),"\n",(0,r.jsx)(s.h2,{id:"fetchfile",children:"fetchFile"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: RequestInfo | URL, optional?: RequestInit) => Promise<Response>"})}),(0,r.jsx)(s.td,{align:"left",children:"从网络拉取文件"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  该项是对 URL 竞速和备用 URL 的封装，如果您启用了这两个功能中的至少一个，swpp 将自动为您生成合适的 ",(0,r.jsx)(s.code,{children:"fetchFile"})," 函数。"]}),"\n",(0,r.jsx)(s.p,{children:"  一般情况下无需修改该项，您的修改会完全覆盖 swpp 原有的逻辑。若您修改了该项但没有手动调用 URL 竞速和备用 URL 的接口，即使设置了相关的属性功能也无法生效。"}),"\n",(0,r.jsx)(s.h2,{id:"isblockrequest",children:"isBlockRequest"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: Request) => boolean"})}),(0,r.jsx)(s.td,{align:"left",children:"判断是否应当阻断请求"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  如果网站中存在需要屏蔽的请求，那么可以使用该功能阻断这些请求。若函数返回了 ",(0,r.jsx)(s.code,{children:"true"}),"，那么 swpp 将不再通过网络拉取文件，而是直接向上级返回 ",(0,r.jsx)(s.code,{children:"204"})," 状态码的响应体。"]}),"\n",(0,r.jsx)(s.p,{children:"  注意：swpp 只能阻断网络请求，而无法阻止上游处理该请求的结果。"}),"\n",(0,r.jsx)(s.h2,{id:"modifyrequest",children:"modifyRequest"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{align:"center",children:"类型"}),(0,r.jsx)(s.th,{align:"left",children:"说明"})]})}),(0,r.jsx)(s.tbody,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{align:"center",children:(0,r.jsx)(s.code,{children:"(request: Request) => Request | null | undefined"})}),(0,r.jsx)(s.td,{align:"left",children:"修改请求"})]})})]}),"\n",(0,r.jsxs)(s.p,{children:["  如果您想要修改请求的内容，可以使用该功能返回一个新的 ",(0,r.jsx)(s.code,{children:"Request"})," 以代替原始的 ",(0,r.jsx)(s.code,{children:"Request"}),"。"]}),"\n",(0,r.jsxs)(s.p,{children:["  您可以修改 ",(0,r.jsx)(s.code,{children:"Request"})," 中的任何内容，但是由于浏览器限制，您无法修改 ",(0,r.jsx)(s.code,{children:"referer"})," 和 ",(0,r.jsx)(s.code,{children:"user-agent"}),"。"]}),"\n",(0,r.jsxs)(s.p,{children:["  函数返回 ",(0,r.jsx)(s.code,{children:"Request"})," 表示对当前资源启用该功能，返回任意转换为 ",(0,r.jsx)(s.code,{children:"false"})," 的值表示禁用。"]})]})}let x={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:s}=Object.assign({},(0,c.a)(),e.components);return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)},pageOpts:{filePath:"pages/config/runtime_dep.mdx",route:"/config/runtime_dep",timestamp:1724072103e3,pageMap:[{kind:"Meta",data:{index:"介绍",quickstart:"快速开始",config:"配置文件"}},{kind:"Folder",name:"config",route:"/config",children:[{kind:"Meta",data:{runtime_dep:"RuntimeDep",cross_env:"CrossEnv",compilation_env:"CompilationEnv",runtime_core:"RuntimeCore",cross_dep:"CrossDep",runtime_event:"RuntimeEvent",dom_config:"DomConfig",modifier:"Modifier"}},{kind:"MdxPage",name:"compilation_env",route:"/config/compilation_env"},{kind:"MdxPage",name:"cross_dep",route:"/config/cross_dep"},{kind:"MdxPage",name:"cross_env",route:"/config/cross_env"},{kind:"MdxPage",name:"dom_config",route:"/config/dom_config"},{kind:"MdxPage",name:"modifier",route:"/config/modifier"},{kind:"MdxPage",name:"runtime_core",route:"/config/runtime_core"},{kind:"MdxPage",name:"runtime_dep",route:"/config/runtime_dep"},{kind:"MdxPage",name:"runtime_event",route:"/config/runtime_event"}]},{kind:"MdxPage",name:"config",route:"/config"},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"quickstart",route:"/quickstart"}],flexsearch:{codeblocks:!0},title:"运行时函数依赖",headings:h},pageNextRoute:"/config/runtime_dep",nextraLayout:i.ZP,themeConfig:o.Z};var j=(0,l.j)(x)},2534:function(e,s,n){"use strict";var r=n(2676);n(5271);var l=n(5458);let i="Swpp 官方文档";s.Z={logo:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"icon",viewBox:"0 0 1024 1024",fill:"currentcolor",children:[(0,r.jsx)("path",{d:"M469.333 810.667V341.333a128 128 0 0 0-128-128H128v597.334zM512 213.333A212.992 212.992 0 0 1 682.667 128h298.666v768H42.667V128h298.666c69.803 0 131.755 33.493 170.667 85.333m42.667 128v469.334H896V213.333H682.667a128 128 0 0 0-128 128"}),(0,r.jsx)("text",{xmlSpace:"preserve",x:"215",y:"485",fillOpacity:"null",stroke:"null",strokeOpacity:"null",strokeWidth:"0",fontFamily:"'Courier New', Courier, monospace",fontSize:"250",fontWeight:"bold",transform:"matrix(2.177 0 0 2.07854 -332.879 -331.617)",children:"S"}),(0,r.jsx)("text",{xmlSpace:"preserve",x:"653",y:"499",fillOpacity:"null",stroke:"null",strokeOpacity:"null",strokeWidth:"0",fontFamily:"'Courier New', Courier, monospace",fontSize:"250",fontWeight:"bold",transform:"matrix(1.78385 0 0 2.06235 -570.614 -357.776)",children:"W"})]}),(0,r.jsx)("span",{style:{marginLeft:".4em",fontWeight:"bold"},children:i})]}),sidebar:{defaultMenuCollapseLevel:1},project:{link:"https://github.com/EmptyDreams/swpp-backends"},docsRepositoryBase:"https://github.com/EmptyDreams/swpp_document/tree/main/",useNextSeoProps:()=>({titleTemplate:"%s – ".concat(i)}),footer:{text:"\xa9 2024-present ".concat(i)},head:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,r.jsx)("meta",{property:"og:description",content:"Service Worker Plus Plus 的官方文档"}),(0,r.jsx)("meta",{name:"keywords",content:"ServiceWorker, swpp"})]}),...l.Z}},5184:function(){}},function(e){e.O(0,[580,888,774,179],function(){return e(e.s=6553)}),_N_E=e.O()}]);