(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9],{1292:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/config/cross_env",function(){return s(2125)}])},2125:function(e,n,s){"use strict";s.r(n),s.d(n,{__toc:function(){return d}});var i=s(2676),r=s(3313),t=s(8136),l=s(2534);s(681);var c=s(5594);let d=[{depth:2,value:"CACHE_NAME",id:"cache_name"},{depth:2,value:"VERSION_PATH",id:"version_path"},{depth:2,value:"ESCAPE",id:"escape"},{depth:2,value:"INVALID_KEY",id:"invalid_key"},{depth:2,value:"STORAGE_TIMESTAMP",id:"storage_timestamp"},{depth:2,value:"UPDATE_CD",id:"update_cd"},{depth:2,value:"UPDATE_JSON_URL",id:"update_json_url"}];function o(e){let n=Object.assign({h1:"h1",p:"p",code:"code",pre:"pre",span:"span",h2:"h2",table:"table",thead:"thead",tr:"tr",th:"th",tbody:"tbody",td:"td"},(0,c.a)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{children:"双期环境变量"}),"\n",(0,i.jsx)(n.p,{children:"  该配置项用于放置需要同时在浏览器环境和 NodeJs 环境中使用的环境变量，其中的内容会被写入到 sw 中。"}),"\n",(0,i.jsxs)(n.p,{children:["  对于每一项配置 ",(0,i.jsx)(n.code,{children:"<KEY>: <value | function(): value>"}),"：",(0,i.jsx)(n.code,{children:"<KEY>"})," 是函数名（推荐使用大写下划线式命名），",(0,i.jsx)(n.code,{children:"value"})," 是环境变量的值。"]}),"\n",(0,i.jsx)(n.p,{children:"  环境变量中应对仅包含非函数内容，当填写的配置项为函数时，swpp 会将函数返回的内容插入到环境变量中。"}),"\n",(0,i.jsx)(n.p,{children:"  配置项填写的函数的执行环境为 NodeJs，所以不要编写依赖浏览器环境的代码。"}),"\n",(0,i.jsx)(n.p,{children:"  例："}),"\n",(0,i.jsx)(n.pre,{"data-language":"typescript","data-theme":"default",children:(0,i.jsxs)(n.code,{"data-language":"typescript","data-theme":"default",children:[(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// 该代码将在 sw.js 中插入一系列常量，同时在编译期也可以动态读取"})}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// const EXAMPLE = 'hello swpp'"})}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// const FUN_EXAMPLE = 'fun hello swpp'"})}),"\n",(0,i.jsx)(n.span,{className:"line",children:" "}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-comment)"},children:"// noinspection TypeScriptUnresolvedReference"})}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"export"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"const"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"crossEnv"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"="}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"defineCrossEnv"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"({"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    EXAMPLE"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'hello swpp'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-punctuation)"},children:","})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"FUN_EXAMPLE"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:":"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"function"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"() {"})]}),"\n",(0,i.jsxs)(n.span,{className:"line",children:[(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"        "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"return"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'fun '"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-keyword)"},children:"+"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:" "}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"this"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:"."}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-constant)"},children:"crossEnv"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-function)"},children:".read"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"("}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-token-string-expression)"},children:"'EXAMPLE'"}),(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:")"})]}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"    }"})}),"\n",(0,i.jsx)(n.span,{className:"line",children:(0,i.jsx)(n.span,{style:{color:"var(--shiki-color-text)"},children:"})"})})]})}),"\n",(0,i.jsx)(n.h2,{id:"cache_name",children:"CACHE_NAME"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{align:"center",children:"类型"}),(0,i.jsx)(n.th,{align:"left",children:"说明"}),(0,i.jsx)(n.th,{align:"center",children:"默认值"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{align:"left",children:"缓存库名称"}),(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"kmarBlogCache"})})]})})]}),"\n",(0,i.jsxs)(n.p,{children:["  该配置项用于设置 swpp 存储缓存的缓存库的名称，可以更改为任意值，默认设置使用 ",(0,i.jsx)(n.code,{children:"kmarBlogCache"})," 是历史遗留问题。"]}),"\n",(0,i.jsx)(n.p,{children:"  请注意：网站部署到线上之后请勿修改该值！除非您知道自己在做什么，否则修改该值可能会造成 swpp 工作异常。"}),"\n",(0,i.jsx)(n.h2,{id:"version_path",children:"VERSION_PATH"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{align:"center",children:"类型"}),(0,i.jsx)(n.th,{align:"left",children:"说明"}),(0,i.jsx)(n.th,{align:"center",children:"默认值"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{align:"left",children:"版本信息地址"}),(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"https://id.v3/"})})]})})]}),"\n",(0,i.jsxs)(n.p,{children:["  该配置项用于设置版本信息存储的地址，因为 swpp 将版本信息封装为 ",(0,i.jsx)(n.code,{children:"Response"})," 存储到 ",(0,i.jsx)(n.code,{children:"Cache"})," 当中，所以需要一个模拟的链接来作为 ",(0,i.jsx)(n.code,{children:"key"}),"。此链接设置为一个网站不可能访问的地址即可，一定要以 ",(0,i.jsx)(n.code,{children:"/"})," 结尾。"]}),"\n",(0,i.jsx)(n.p,{children:"  注意：网站部署到线上后请勿修改该值！除非您知道自己在做什么，否则修改该值可能会造成 swpp 工作异常。"}),"\n",(0,i.jsx)(n.h2,{id:"escape",children:"ESCAPE"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{align:"center",children:"类型"}),(0,i.jsx)(n.th,{align:"left",children:"说明"}),(0,i.jsx)(n.th,{align:"center",children:"默认值"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsx)(n.td,{align:"left",children:"逃生门版本号"}),(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"0"})})]})})]}),"\n",(0,i.jsx)(n.p,{children:"  该配置项用于设置逃生门的版本号，用户的逃生门信息会存储到版本信息当中，当用户本地的逃生门与设置的逃生门版本号不同时就会触发逃生门。"}),"\n",(0,i.jsx)(n.p,{children:"  swpp 进行增量更新的原理是网站 DOM 端在启动时发送一个消息到 SW 端，SW 收到信息后开始进行更新操作。如果用户错误地修改了 DOM 端的代码，导致无法发送信息到 SW 端将导致 swpp 永远无法进行增量更新。此时如果对 DOM 的 JS 使用了无限期缓存，将会产生一个死循环：“修复 DOM JS 需要增量更新，但是增量更新又需要已有的 DOM JS 工作正常”。"}),"\n",(0,i.jsx)(n.p,{children:"  逃生门的作用就是为了解决上述问题，当用户由于修改 DOM JS 或其它操作产生了无法修复的问题时，可以通过逃生门强制清除用户本地缓存的所有数据。"}),"\n",(0,i.jsx)(n.p,{children:"  注意：只要用户的版本号和设置的版本号不相等就会触发逃生门。"}),"\n",(0,i.jsx)(n.h2,{id:"invalid_key",children:"INVALID_KEY"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{align:"center",children:"类型"}),(0,i.jsx)(n.th,{align:"left",children:"说明"}),(0,i.jsx)(n.th,{align:"center",children:"默认值"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{align:"left",children:"缓存失效标识的 key"}),(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"X-Swpp-Invalid"})})]})})]}),"\n",(0,i.jsx)(n.p,{children:"  swpp 使缓存失效的原理是将失效的缓存打上一个失效标记，读取缓存时检查是否存在失效标记，如果存在则尝试通过网络拉取最新的内容然后替换缓存，拉取失败则继续使用缓存的内容。"}),"\n",(0,i.jsx)(n.p,{children:"  该配置项用于修改 swpp 使用的 key，这个 key 是存储在响应头当中的，所以必须是一个合法的 HTTP 响应头名称。"}),"\n",(0,i.jsx)(n.p,{children:"  注意：网站部署到线上后请勿修改该值！除非您知道自己在做什么，否则修改该值可能会造成 swpp 工作异常。"}),"\n",(0,i.jsx)(n.h2,{id:"storage_timestamp",children:"STORAGE_TIMESTAMP"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{align:"center",children:"类型"}),(0,i.jsx)(n.th,{align:"left",children:"说明"}),(0,i.jsx)(n.th,{align:"center",children:"默认值"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{align:"left",children:"缓存时间戳的 key"}),(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"X-Swpp-Time"})})]})})]}),"\n",(0,i.jsx)(n.p,{children:"  swpp 实现定期缓存的原理是在响应头中存储一个时间戳，该配置项用于修改 swpp 使用的响应头的名称。"}),"\n",(0,i.jsx)(n.p,{children:"  注意：网站部署到线上后请勿修改该值！除非您知道自己在做什么，否则修改该值可能会造成 swpp 工作异常。"}),"\n",(0,i.jsx)(n.h2,{id:"update_cd",children:"UPDATE_CD"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{align:"center",children:"类型"}),(0,i.jsx)(n.th,{align:"left",children:"说明"}),(0,i.jsx)(n.th,{align:"center",children:"默认值"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"number"})}),(0,i.jsx)(n.td,{align:"left",children:"检查更新的最短时间间隔（毫秒）"}),(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"600000"})})]})})]}),"\n",(0,i.jsx)(n.p,{children:"  该项用于设置检查更新的最短时间间隔，当第二次更新与第一次更新时间之差小于该值时，将会取消第二次更新，避免用户频繁刷新时不停的进行更新。"}),"\n",(0,i.jsx)(n.h2,{id:"update_json_url",children:"UPDATE_JSON_URL"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{align:"center",children:"类型"}),(0,i.jsx)(n.th,{align:"left",children:"说明"}),(0,i.jsx)(n.th,{align:"center",children:"默认值"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{align:"center",children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{align:"left",children:"版本文件所在 URL"}),(0,i.jsx)(n.td,{align:"center",children:"省略"})]})})]}),"\n",(0,i.jsx)(n.p,{children:"  该项自动生成，仅用于向 sw 中插入数据，不要手动填写。"})]})}let a={MDXContent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,c.a)(),e.components);return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)},pageOpts:{filePath:"pages/config/cross_env.mdx",route:"/config/cross_env",timestamp:1723883597e3,pageMap:[{kind:"Meta",data:{index:"介绍",quickstart:"快速开始",config:"配置文件"}},{kind:"Folder",name:"config",route:"/config",children:[{kind:"Meta",data:{compilation_env:"CompilationEnv",cross_env:"CrossEnv",runtime_dep:"RuntimeDep",cross_dep:"CrossDep",runtime_core:"RuntimeCore",runtime_event:"RuntimeEvent",dom_config:"DomConfig",modifier:"Modifier"}},{kind:"MdxPage",name:"compilation_env",route:"/config/compilation_env"},{kind:"MdxPage",name:"cross_dep",route:"/config/cross_dep"},{kind:"MdxPage",name:"cross_env",route:"/config/cross_env"},{kind:"MdxPage",name:"dom_config",route:"/config/dom_config"},{kind:"MdxPage",name:"modifier",route:"/config/modifier"},{kind:"MdxPage",name:"runtime_core",route:"/config/runtime_core"},{kind:"MdxPage",name:"runtime_dep",route:"/config/runtime_dep"},{kind:"MdxPage",name:"runtime_event",route:"/config/runtime_event"}]},{kind:"MdxPage",name:"config",route:"/config"},{kind:"MdxPage",name:"index",route:"/"},{kind:"MdxPage",name:"quickstart",route:"/quickstart"}],flexsearch:{codeblocks:!0},title:"双期环境变量",headings:d},pageNextRoute:"/config/cross_env",nextraLayout:t.ZP,themeConfig:l.Z};n.default=(0,r.j)(a)},2534:function(e,n,s){"use strict";var i=s(2676);s(5271);var r=s(5458);let t="Swpp 官方文档";n.Z={logo:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",className:"icon",viewBox:"0 0 1024 1024",fill:"currentcolor",children:[(0,i.jsx)("path",{d:"M469.333 810.667V341.333a128 128 0 0 0-128-128H128v597.334zM512 213.333A212.992 212.992 0 0 1 682.667 128h298.666v768H42.667V128h298.666c69.803 0 131.755 33.493 170.667 85.333m42.667 128v469.334H896V213.333H682.667a128 128 0 0 0-128 128"}),(0,i.jsx)("text",{xmlSpace:"preserve",x:"215",y:"485",fillOpacity:"null",stroke:"null",strokeOpacity:"null",strokeWidth:"0",fontFamily:"'Courier New', Courier, monospace",fontSize:"250",fontWeight:"bold",transform:"matrix(2.177 0 0 2.07854 -332.879 -331.617)",children:"S"}),(0,i.jsx)("text",{xmlSpace:"preserve",x:"653",y:"499",fillOpacity:"null",stroke:"null",strokeOpacity:"null",strokeWidth:"0",fontFamily:"'Courier New', Courier, monospace",fontSize:"250",fontWeight:"bold",transform:"matrix(1.78385 0 0 2.06235 -570.614 -357.776)",children:"W"})]}),(0,i.jsx)("span",{style:{marginLeft:".4em",fontWeight:"bold"},children:t})]}),sidebar:{defaultMenuCollapseLevel:1},project:{link:"https://github.com/EmptyDreams/swpp-backends"},docsRepositoryBase:"https://github.com/EmptyDreams/swpp_document/tree/main/",useNextSeoProps:()=>({titleTemplate:"%s – ".concat(t)}),footer:{text:"\xa9 2024-present ".concat(t)},head:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),(0,i.jsx)("meta",{property:"og:description",content:"Service Worker Plus Plus 的官方文档"}),(0,i.jsx)("meta",{name:"keywords",content:"ServiceWorker, swpp"})]}),...r.Z}},5184:function(){}},function(e){e.O(0,[580,888,774,179],function(){return e(e.s=1292)}),_N_E=e.O()}]);